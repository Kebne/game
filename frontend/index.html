<!DOCTYPE html>
<html>
<head>
    <title>The game</title>
    <meta charset="UTF-8">
    <meta lang="se-SV">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/css?family=Roboto+Slab&display=swap" rel="stylesheet">
    <link href="main.css" rel="stylesheet">
</head>

<body id="kebne-game">
  
  <main>
    <div class="game-grid">
      <div class="game-countdown"></div>
      <div class="game-correct-answer"></div>
      <div class="game-choice"></div>
      <div class="game-questions"></div>
    </div>
    

  <section data-id="player-input" style="background-color: #999; padding: var(--standard-padding)">
      
      <div class="game-round"></div>
      <div class="player-status"></div>
      <div class="player-marks"></div>
    
      <div class="player-input-wrapper">
        
        <game-betting-slider></game-betting-slider>
        

      <div class="player-input">  
        <div><button onclick="bet()">Betta</button></div>
        <div><button onclick="pass()">Passa</button></div>
        <div><button onclick="fold()">Lägga sig</button></div>
      </div>

    </div>

  </section>


<!-- this only for development to easier see were things are. Remove at production -->
<section>
  <div class="game-descript" style="background-color: #444; padding: var(--standard-padding); line-height: 1.7; margin-top: 6rem; font-weight: 700">
    <ul>
      <li style="color: #DCF7F3">- Countdown-timer. Css-class: .game-countdown.</li>
      <li style="color: #FFFCDD">- Correct answer. Css-class: .game-correct-answer.</li>
      <li style="color: #FFD8D8">- Player choice, Css-class: .game-choice.</li>
      <li style="color: #e3ffdd">- Questions. Css-class: .game-questions.</li>
    </ul>
  </div>
</section>

  </main>
</body>

<script>
var player = {
    marks: 1000,
    pass: false,
    fold: false,
  }


  // Slider 
 
class bettingSlider extends HTMLElement {
  constructor() {
    super();
    const shadow = this.attachShadow({mode: 'open'});
    
    
    let playerInputStyle = document.createElement('style');
    playerInputStyle.innerHTML = `
      :host {display: block;} 
    `;

    let templateElement = document.createElement('template');
    templateElement.innerHTML = `
      <div class="game-slider">
        <input type="range" min="10" max="100" value="10" step="10" class="bet-slider">
        <output class="bet-slider-output"></output>
      </div>
    `;
    shadow.append(playerInputStyle);
    shadow.appendChild(templateElement.content.cloneNode(true));

    const slider = shadow.querySelector('.bet-slider');
    const output = shadow.querySelector('.bet-slider-output');
    output.innerHTML = slider.value;
    slider.addEventListener('change', sliderOutput);
    function sliderOutput() {
      output.innerHTML = slider.value;
    };
  }
};
window.customElements.define('game-betting-slider', bettingSlider);



  
  // Other player input

  var statusOutput = `Passat är: <i>${player.pass}</i>. Lagt är: <i>${player.fold}</i>.`
  
  let playerMarks = document.querySelector('.player-marks');
  playerMarks.innerHTML = `Du har ${player.marks} marker`;

  let playerStatus = document.querySelector('.player-status');
  playerStatus.innerHTML = `Passat är: <i>${player.pass}</i>. Lagt är: <i>${player.fold}</i>.`;

  function bet() {
    let slider = document.querySelector("game-betting-slider");
    let sliderValue = slider.shadowRoot.querySelector(".bet-slider-output").value;
    player.marks = player.marks - sliderValue;
    let playerMarks = document.querySelector('.player-marks');
    playerMarks.innerHTML = `Du har ${player.marks} marker`;
  };

  function pass() {
    player.pass = true;
    let playerStatus = document.querySelector('.player-status');
    playerStatus.innerHTML = `Passat är: <i>${player.pass}</i>. Lagt är: <i>${player.fold}</i>.`;
  };

  function fold() {
    player.fold = true;
    let playerStatus = document.querySelector('.player-status');
    playerStatus.innerHTML = `Passat är: <i>${player.pass}</i>. Lagt är: <i>${player.fold}</i>.`;
  };

  function gameRoundNr() {
    let gameRoundNrOutput = document.querySelector('.game-round');
    let gameRoundNr = 1;
    gameRoundNrOutput.innerHTML = `Runda ${gameRoundNr}`
  };
  gameRoundNr();





</script>

<script type="module">
  
  
  import {questions} from './modules/questions.js';
  import {createQuestionForm} from './modules/template.js';
  import {countDown} from './modules/countdown.js';
  import {playerChoice} from './modules/playerchoice.js';
  import {players} from './modules/players.js';
  import {seatPlayer} from './modules/seatplayer.js'
  const seats = [];
  
  window.onload = gameEngine();
    
  function gameEngine(currentRound = 1, questionNumber = 1) {
    console.log(`currentRound ${currentRound}, currentQuestion ${questionNumber}`);
    let currentQuestion = questions[`question${questionNumber}`];
    createQuestionForm(currentQuestion);
    countDown(4, currentQuestion);

    let form = document.forms[0];
    let radios = form.elements['questions'];
    form.addEventListener('change', function() {playerChoice(radios)});

    // Exemple of how to seat players
    seatPlayer(seats, 'myName');
    seatPlayer(seats, 'myYourname');
    console.log(`Spelare ${seats}`);
  };

</script>

</html>
